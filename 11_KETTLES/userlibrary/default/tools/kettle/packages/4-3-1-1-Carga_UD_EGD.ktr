<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>4-3-1-1-Carga_UD_EGD</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>&#47;</directory>
    <parameters>
    </parameters>
    <log>
<trans-log-table><connection/>
<schema/>
<table/>
<size_limit_lines/>
<interval/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STATUS</id><enabled>Y</enabled><name>STATUS</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name><subject/></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name><subject/></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name><subject/></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name><subject/></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name><subject/></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name><subject/></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>STARTDATE</id><enabled>Y</enabled><name>STARTDATE</name></field><field><id>ENDDATE</id><enabled>Y</enabled><name>ENDDATE</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>DEPDATE</id><enabled>Y</enabled><name>DEPDATE</name></field><field><id>REPLAYDATE</id><enabled>Y</enabled><name>REPLAYDATE</name></field><field><id>LOG_FIELD</id><enabled>Y</enabled><name>LOG_FIELD</name></field></trans-log-table>
<perf-log-table><connection/>
<schema/>
<table/>
<interval/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>SEQ_NR</id><enabled>Y</enabled><name>SEQ_NR</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STEPNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>STEP_COPY</id><enabled>Y</enabled><name>STEP_COPY</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>INPUT_BUFFER_ROWS</id><enabled>Y</enabled><name>INPUT_BUFFER_ROWS</name></field><field><id>OUTPUT_BUFFER_ROWS</id><enabled>Y</enabled><name>OUTPUT_BUFFER_ROWS</name></field></perf-log-table>
<channel-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>LOGGING_OBJECT_TYPE</id><enabled>Y</enabled><name>LOGGING_OBJECT_TYPE</name></field><field><id>OBJECT_NAME</id><enabled>Y</enabled><name>OBJECT_NAME</name></field><field><id>OBJECT_COPY</id><enabled>Y</enabled><name>OBJECT_COPY</name></field><field><id>REPOSITORY_DIRECTORY</id><enabled>Y</enabled><name>REPOSITORY_DIRECTORY</name></field><field><id>FILENAME</id><enabled>Y</enabled><name>FILENAME</name></field><field><id>OBJECT_ID</id><enabled>Y</enabled><name>OBJECT_ID</name></field><field><id>OBJECT_REVISION</id><enabled>Y</enabled><name>OBJECT_REVISION</name></field><field><id>PARENT_CHANNEL_ID</id><enabled>Y</enabled><name>PARENT_CHANNEL_ID</name></field><field><id>ROOT_CHANNEL_ID</id><enabled>Y</enabled><name>ROOT_CHANNEL_ID</name></field></channel-log-table>
<step-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STEPNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>STEP_COPY</id><enabled>Y</enabled><name>STEP_COPY</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>LOG_FIELD</id><enabled>N</enabled><name>LOG_FIELD</name></field></step-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
        <partitionschema>
          <name>TOPAZETL</name>
          <dynamic>N</dynamic>
          <partitions_per_slave/>
        </partitionschema>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
  <created_user>-</created_user>
  <created_date>2016&#47;01&#47;21 15:27:04.814</created_date>
  <modified_user>-</modified_user>
  <modified_date>2016&#47;01&#47;21 15:27:04.814</modified_date>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>OdsStgDS</name>
    <server/>
    <type>ORACLE</type>
    <access>JNDI</access>
    <database>OdsStgDS</database>
    <port>1521</port>
    <username/>
    <password>Encrypted </password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>1521</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <order>
  <hop> <from>Leo T_SALDOS CA,CTS y CC</from><to>Cargo UD_EGD 2</to><enabled>Y</enabled> </hop>  <hop> <from>Leo T_SALDOS de DPF</from><to>Cargo UD_EGD</to><enabled>Y</enabled> </hop>  <hop> <from>Leo T_TMP_INT_TLIVCART</from><to>Cargo UD_EGD 3</to><enabled>Y</enabled> </hop>  <hop> <from>Leo T_VW_ANX15_EMP_TIPO_ACRE</from><to>Cargo MD_TIPO_ACREEDOR</to><enabled>Y</enabled> </hop>  </order>
  <step>
    <name>Cargo MD_TIPO_ACREEDOR</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>OdsStgDS</connection>
    <commit>1000</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>ODS</schema>
      <table>MD_TIPO_ACREEDOR</table>
      <key>
        <name>CO_TIPO_ACRE</name>
        <field>CO_TIPO_ACRE</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>CO_TIPO_ACRE</name>
        <rename>CO_TIPO_ACRE</rename>
        <update>N</update>
      </value>
      <value>
        <name>ID_TIPO_ACRE</name>
        <rename>ID_TIPO_ACRE</rename>
        <update>Y</update>
      </value>
      <value>
        <name>DE_TIPO_ACRE</name>
        <rename>DE_TIPO_ACRE</rename>
        <update>Y</update>
      </value>
      <value>
        <name>FE_ACTU_DIA</name>
        <rename>FE_ACTU_DIA</rename>
        <update>Y</update>
      </value>
    </lookup>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>745</xloc>
      <yloc>374</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Cargo UD_EGD</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>2</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>OdsStgDS</connection>
    <schema>ODS</schema>
    <table>UD_EGD</table>
    <commit>10000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>N</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>745</xloc>
      <yloc>43</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Cargo UD_EGD 2</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>2</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>OdsStgDS</connection>
    <schema>ODS</schema>
    <table>UD_EGD</table>
    <commit>10000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>N</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>745</xloc>
      <yloc>139</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Cargo UD_EGD 3</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>2</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>OdsStgDS</connection>
    <schema>ODS</schema>
    <table>UD_EGD</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>N</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>745</xloc>
      <yloc>253</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Leo T_SALDOS CA,CTS y CC</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>OdsStgDS</connection>
    <sql>--Caso producto Ahorro, CTS y Cuenta Corriente
--@001 JZQ CASO-6428 Homologar EGD_AHORRO_PRO con EGD (ODS)
SELECT 
  EXTRACT(YEAR FROM TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;))*100+EXTRACT(MONTH FROM TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;)) AS NU_PERI_MES,
  TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) AS FE_SALDO,
  TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) AS FE_PROCESO,
  s.OPERACION AS NU_OPERACION,
  s.ORDINAL AS NU_ORDINAL,
  s.SUCURSAL AS CO_SUCURSAL,
  s.C1803 AS CO_CLIENTE,
  s.MONEDA AS CO_MONEDA,
  s.PRODUCTO AS CO_PRODUCTO,
  s.CUENTA AS NU_CUENTA,
  s.C1601 AS MO_APERTURA,
  NVL((s.C1627 -s.C1621),0) AS NU_PLAZO,
  s.C1627 AS FE_VENCIMIENTO,
--@001 Ini: INICIO DEL CAMBIO
--s.C2294 AS VL_TASA_INTE,
NVL(S.tasa_interes,0) AS VL_TASA_INTE,
--@001 FIN DEL CAMBIO
  s.C1659 AS CO_TIPO_RENO,
  s.C1670 AS CO_ANALISTA,
  NVL((SELECT ACP.CARGO FROM STG.T_RH_FUNCIONARIO FUNC JOIN STG.T_ADR_CAR_PUE ACP ON ACP.PUESTO=FUNC.PUESTO WHERE FUNC.CODFUNCIONARIO=s.C1670),0) AS CO_CARG_ANAL,
  NVL((SELECT FUNC.PUESTO FROM STG.T_RH_FUNCIONARIO FUNC WHERE FUNC.CODFUNCIONARIO=s.C1670),0) AS CO_PUES_ANAL,
  NVL((SELECT FUNC.CODAGENCIA FROM STG.T_RH_FUNCIONARIO FUNC WHERE FUNC.CODFUNCIONARIO=s.C1670),0) AS CO_SUCU_ANAL,
  NVL((SELECT c.MEDIOORIGEN FROM STG.T_AP_CATALOGODPF c WHERE c.SUCURSAL=s.SUCURSAL AND c.PRODUCTO=s.PRODUCTO AND c.CUENTA=s.CUENTA AND c.MONEDA=s.MONEDA AND c.OPERACION=s.OPERACION AND c.ORDINAL=s.ORDINAL ),&apos; &apos;) AS NO_MEDI_ORIG,
  &apos;0&apos; AS TI_PAGO_APER,
  0 AS MO_ITF_APER,
  NVL((SELECT c.ORIGENLLEGADA FROM STG.T_AP_CATALOGODPF c WHERE c.SUCURSAL=s.SUCURSAL AND c.PRODUCTO=s.PRODUCTO AND c.CUENTA=s.CUENTA AND c.MONEDA=s.MONEDA AND c.OPERACION=s.OPERACION AND c.ORDINAL=s.ORDINAL ),&apos; &apos;) AS NO_ORIG_LLEG,
  s.C1621 AS FE_APERTURA,
  NVL((CASE WHEN (TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) &gt; s.C1627)  THEN (s.C1627-s.C1621)
     ELSE (TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) - s.C1621)
  END),0) AS NU_DIAS_TRAN,
  NVL((CASE WHEN (TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) &gt; s.C1627)  THEN 0
     ELSE (s.C1627 - TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;))
  END),0) AS NU_DIAS_REST_DPF,

--@001 Ini: INICIO DEL CAMBIO
--NVL((SELECT ROUND(NVL(sd.INTERESESPAGO, 0),2) AS MO_INTE_DEVE FROM STG.T_SALDOS_DIARIOS sd WHERE sd.SALDO_JTS_OID=s.JTS_OID),0) AS MO_INTE_DEVE ,
 CASE when ROUND(NVL(hv.monto, 0),2) = 0 then ROUND(NVL(SD.int_pag_ant, 0), 2) ELSE 0 END  AS MO_INTE_DEVE,
--NVL((SELECT ROUND(NVL(sd.INTERESESPAGO, 0),2) + NVL(sd.SALDO_AL_CORTE, 0)  FROM STG.T_SALDOS_DIARIOS sd WHERE sd.SALDO_JTS_OID=s.JTS_OID ),0)  AS MO_SALD_ACTU,
ROUND(CASE WHEN NVL(HV.MONTO, 0) = 0 THEN NVL(SD.INT_PAG_ANT, 0) ELSE 0 END + NVL(SD.SALDO_AL_CORTE, 0), 2) AS MO_SALD_ACTU,
--@001 FIN DEL CAMBIO

  NVL((SELECT ROUND(((ROUND(NVL(sd.INTERESESPAGO, 0),2) + NVL(sd.SALDO_AL_CORTE, 0))*m.C6440),2)  FROM STG.T_TMP_SALDOS_DIARIOS_01 sd WHERE sd.SALDO_JTS_OID=s.JTS_OID  ),0) AS MO_SALD_ACTU_MN,
  s.C1728 AS CO_ESTA_OPER,
  CASE WHEN (s.C1627 - TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;)) &gt; 360 THEN &apos;L&apos;
     ELSE &apos;C&apos;
  END AS CO_TIPO_PLAZ,
  &apos;0&apos; AS CO_TIPO_ACRE,
--@001 Ini: INICIO DEL CAMBIO  
--  s.C1730 AS CO_CUEN_CONT,
  sD.Rubrocontable as CO_CUEN_CONT,
--@001 Fin: FIN DEL CAMBIO
  s.C1705 AS CO_PIZARRA,
  0 AS IN_ENCAJE,
  NVL((SELECT sd.SALDO_AL_CORTE FROM STG.T_TMP_SALDOS_DIARIOS_01 sd WHERE sd.SALDO_JTS_OID=s.JTS_OID),0)AS MO_CAPITAL,
  (SELECT c.MOTIVO FROM STG.T_AP_CATALOGODPF c WHERE c.SUCURSAL=s.SUCURSAL AND c.PRODUCTO=s.PRODUCTO AND c.CUENTA=s.CUENTA AND c.MONEDA=s.MONEDA AND c.OPERACION=s.OPERACION AND c.ORDINAL=s.ORDINAL ) AS CO_MOTI_CANC,
  NVL((SELECT ccp.CANT_CUENT_PASIV FROM STG.T_CANT_CUENTA_PASIVAS ccp WHERE ccp.CO_CLIENTE=s.C1803),0) AS NU_TOTA_CTAS,
  m.C6440 AS VL_TIPO_CAMB_OFIC,
  0 AS NU_DOCU_TLV,
    s.JTS_OID AS IN_SALD_JTS_OID,
    (SELECT CLIENTES.C1058 FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS CO_ACTI_ECON_INTE,
    (SELECT CLIENTES.C1840 FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS CO_SECT_ECON_ALTE,
    (SELECT CLIENTES.C3205 FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS CO_ACTIVIDAD,
    (SELECT CLIENTES.C1034 FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS CO_ACTI_CIIU, 
    (SELECT CLIENTES.C1584 FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS CO_SECT_ECON_INTE,
    (SELECT CASE CLIENTES.EMPLEADO WHEN &apos;E&apos; THEN 1
                                 ELSE 0
            END 
      FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS IN_EMPLEADO,
	DECODE (NVL(s.COD_CAN,0),&apos; &apos;,0,1) AS IN_ESTA_PASI,
	(SELECT PROD.C6252 FROM STG.T_CO_PRODUCTOS PROD WHERE PROD.C6250=s.PRODUCTO AND PROD.C6252 = s.C9314) AS CO_TIPO_PASI,
	NVL((CASE WHEN s.C9314 = 3 THEN (SELECT PROD.C6734 FROM STG.T_CO_PRODUCTOS PROD WHERE PROD.C6250=s.PRODUCTO AND PROD.C6252 = s.C9314) 
	     ELSE 0 
    END),0) AS CO_TIPO_AHOR,
	0 AS NU_PLAZ_RENO,
  SYSDATE AS FE_ACTU_DIA
--@001 Ini: INICIO DEL CAMBIO  
--FROM STG.T_SALDOS_02 s
FROM STG.T_TMP_SALDOS_04 S
join STG.T_tmp_saldos_diarios_01 SD on S.jts_oid = SD.Saldo_Jts_Oid
left join STG.T_tmp_historia_vista_egd hv  on hv.saldo_jts_oid = S.jts_oid and hv.fecha_procesado = &apos;${FECHAPROCESOEDY_S}&apos;
--@001 Fin: FIN DEL CAMBIO
JOIN STG.T_CO_MONEDAS_01 m ON s.MONEDA=m.C6399   
WHERE
  s.C9314 IN (2,3) AND
--@001 Ini: INICIO DEL CAMBIO
--EXISTS (SELECT 1 FROM STG.T_SALDOS_DIARIOS sd WHERE sd.SALDO_JTS_OID=s.JTS_OID AND sd.SALDO_AL_CORTE&lt;&gt;0)
(SD.Saldo_Al_Corte &lt;&gt; 0  or (SD.Saldo_Al_Corte = 0 and sd.interesespago &lt;&gt; 0))
--@001 FIN DEL CAMBIO</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>Y</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>231</xloc>
      <yloc>139</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Leo T_SALDOS de DPF</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>OdsStgDS</connection>
    <sql>--Caso Producto DPF
--@001 JZQ CASO-6428 Homologar EGD_AHORRO_PRO con EGD (ODS)
SELECT 
  EXTRACT(YEAR FROM TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;))*100+EXTRACT(MONTH FROM TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;)) AS NU_PERI_MES,
  TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) AS FE_SALDO,
  TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) AS FE_PROCESO,
  s.OPERACION AS NU_OPERACION,
  s.ORDINAL AS NU_ORDINAL,
  s.SUCURSAL AS CO_SUCURSAL,
  s.C1803 AS CO_CLIENTE,
  s.MONEDA AS CO_MONEDA,
  s.PRODUCTO AS CO_PRODUCTO,
  s.CUENTA AS NU_CUENTA,
  s.C1601 AS MO_APERTURA,
  NVL((s.C1627 -s.C1621),0) AS NU_PLAZO,
  s.C1627 AS FE_VENCIMIENTO,
--s.C1632 AS VL_TASA_INTE,
--@001 Ini: INICIO DEL CAMBIO
--s.C2294 AS VL_TASA_INTE,
  NVL(S.C1632,0)  AS VL_TASA_INTE,
--@001 FIN DEL CAMBIO
  s.C1659 AS CO_TIPO_RENO,
  s.C1670 AS CO_ANALISTA,
  NVL((SELECT ACP.CARGO FROM STG.T_RH_FUNCIONARIO FUNC JOIN STG.T_ADR_CAR_PUE ACP ON ACP.PUESTO=FUNC.PUESTO WHERE FUNC.CODFUNCIONARIO=s.C1670),0) AS CO_CARG_ANAL,
  NVL((SELECT FUNC.PUESTO FROM STG.T_RH_FUNCIONARIO FUNC WHERE FUNC.CODFUNCIONARIO=s.C1670),0) AS CO_PUES_ANAL,
  NVL((SELECT FUNC.CODAGENCIA FROM STG.T_RH_FUNCIONARIO FUNC WHERE FUNC.CODFUNCIONARIO=s.C1670),0) AS CO_SUCU_ANAL,
  (SELECT c.MEDIOORIGEN FROM STG.T_AP_CATALOGODPF c WHERE c.SUCURSAL=s.SUCURSAL AND c.PRODUCTO=s.PRODUCTO AND c.CUENTA=s.CUENTA AND c.MONEDA=s.MONEDA AND c.OPERACION=s.OPERACION AND c.ORDINAL=s.ORDINAL ) AS NO_MEDI_ORIG,
  (SELECT c.PAGO_APERTURA FROM STG.T_AP_CATALOGODPF c WHERE c.SUCURSAL=s.SUCURSAL AND c.PRODUCTO=s.PRODUCTO AND c.CUENTA=s.CUENTA AND c.MONEDA=s.MONEDA AND c.OPERACION=s.OPERACION AND c.ORDINAL=s.ORDINAL ) AS TI_PAGO_APER,
  (SELECT c.ITF_APERTURA FROM STG.T_AP_CATALOGODPF c WHERE c.SUCURSAL=s.SUCURSAL AND c.PRODUCTO=s.PRODUCTO AND c.CUENTA=s.CUENTA AND c.MONEDA=s.MONEDA AND c.OPERACION=s.OPERACION AND c.ORDINAL=s.ORDINAL ) AS MO_ITF_APER,
  (SELECT c.ORIGENLLEGADA FROM STG.T_AP_CATALOGODPF c WHERE c.SUCURSAL=s.SUCURSAL AND c.PRODUCTO=s.PRODUCTO AND c.CUENTA=s.CUENTA AND c.MONEDA=s.MONEDA AND c.OPERACION=s.OPERACION AND c.ORDINAL=s.ORDINAL ) AS NO_ORIG_LLEG,
  s.C1621 AS FE_APERTURA,
  NVL((CASE WHEN (TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) &gt; s.C1627)  THEN (s.C1627-s.C1621)
     ELSE (TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) - s.C1621)
  END),0) AS NU_DIAS_TRAN,
  NVL((CASE WHEN (TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) &gt; s.C1627)  THEN 0
     ELSE (s.C1627 -TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;))
  END),0) AS NU_DIAS_REST_DPF,

--@001 Ini: INICIO DEL CAMBIO
--NVL((SELECT CASE WHEN NVL(sd.INT_CONTABILIZADOS, 0) &gt; NVL(sd.INT_REALIZADOS, 0) THEN NVL(sd.INT_CONTABILIZADOS, 0) - NVL(sd.INT_REALIZADOS, 0) ELSE 0 END  AS MO_INTE_DEVE FROM STG.T_SALDOS_DIARIOS sd WHERE sd.SALDO_JTS_OID=s.JTS_OID),0) AS MO_INTE_DEVE ,
--  NVL((SELECT ROUND(NVL(sd.INT_CONTABILIZADOS, 0)-(NVL(sd.INT_REALIZADOS, 0)),2) AS MO_INTE_DEVE FROM STG.T_SALDOS_DIARIOS sd WHERE sd.SALDO_JTS_OID=s.JTS_OID),0) AS MO_INTE_DEVE ,
ROUND(NVL(SD.INT_CONTABILIZADOS, 0)- NVL(SD.INT_REALIZADOS, 0),2) MO_INTE_DEVE,

--NVL((SELECT CASE WHEN NVL(sd.INT_CONTABILIZADOS, 0) &gt; NVL(sd.INT_REALIZADOS, 0) THEN NVL(sd.INT_CONTABILIZADOS, 0) - NVL(sd.INT_REALIZADOS, 0) ELSE 0 END + NVL(sd.SALDO_AL_CORTE, 0)  FROM STG.T_SALDOS_DIARIOS sd WHERE sd.SALDO_JTS_OID=s.JTS_OID ),0) AS MO_SALD_ACTU,
  NVL(SD.INT_CONTABILIZADOS, 0)- NVL(SD.INT_REALIZADOS, 0) + NVL(SD.Saldo_Al_Corte, 0) AS MO_SALD_ACTU,
--@001 FIN DEL CAMBIO

  NVL((SELECT round(((CASE WHEN NVL(sd.INT_CONTABILIZADOS, 0) &gt; NVL(sd.INT_REALIZADOS, 0) THEN NVL(sd.INT_CONTABILIZADOS, 0) - NVL(sd.INT_REALIZADOS, 0) ELSE 0 END + NVL(sd.SALDO_AL_CORTE, 0))*m.C6440),2)  FROM STG.T_tmp_saldos_diarios_01 sd WHERE sd.SALDO_JTS_OID=s.JTS_OID  ),0) AS MO_SALD_ACTU_MN,
  CASE s.C1679 WHEN &apos; &apos; THEN &apos;N&apos;
         ELSE &apos;B&apos;
  END AS CO_ESTA_OPER,
 CASE WHEN (s.C1627 - s.C1621) - (TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) - s.C1621) &gt; 360 THEN &apos;L&apos;
     ELSE &apos;C&apos;
  END AS CO_TIPO_PLAZ,
  &apos;0&apos; AS CO_TIPO_ACRE,
  s.C1730 AS CO_CUEN_CONT,
  s.C1705 AS CO_PIZARRA,
  0 AS IN_ENCAJE,
--@001 Ini: INICIO DEL CAMBIO  
--  s.C1604 AS MO_CAPITAL,
--@001 Fin: FIN DEL CAMBIO
  NVL(SD.Saldo_Al_Corte, 0) AS MO_CAPITAL,
  (SELECT c.MOTIVO FROM STG.T_AP_CATALOGODPF c WHERE c.SUCURSAL=s.SUCURSAL AND c.PRODUCTO=s.PRODUCTO AND c.CUENTA=s.CUENTA AND c.MONEDA=s.MONEDA AND c.OPERACION=s.OPERACION AND c.ORDINAL=s.ORDINAL ) AS CO_MOTI_CANC,
  NVL((SELECT ccp.CANT_CUENT_PASIV FROM STG.T_CANT_CUENTA_PASIVAS ccp WHERE ccp.CO_CLIENTE=s.C1803),0) AS NU_TOTA_CTAS,
  m.C6440 AS VL_TIPO_CAMB_OFIC,
  0 AS NU_DOCU_TLV,
  s.JTS_OID AS IN_SALD_JTS_OID,
  (SELECT CLIENTES.C1058 FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS CO_ACTI_ECON_INTE,
  (SELECT CLIENTES.C1840 FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS CO_SECT_ECON_ALTE,
  (SELECT CLIENTES.C3205 FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS CO_ACTIVIDAD,
  (SELECT CLIENTES.C1034 FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS CO_ACTI_CIIU, 
  (SELECT CLIENTES.C1584 FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS CO_SECT_ECON_INTE,
  (SELECT CASE CLIENTES.EMPLEADO WHEN &apos;E&apos; THEN 1
                               ELSE 0
                     END 
    FROM STG.T_CL_CLIENTES_01 CLIENTES WHERE  CLIENTES.C0902=s.C1803)  AS IN_EMPLEADO,
 0 AS IN_ESTA_PASI,
 (SELECT PROD.C6252 FROM STG.T_CO_PRODUCTOS PROD WHERE PROD.C6250=s.PRODUCTO AND PROD.C6252 = s.C9314) AS CO_TIPO_PASI,
 0 AS CO_TIPO_AHOR,
 NVL((SELECT (TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) - c.VENCIMIENTO) FROM STG.T_AP_CATALOGODPF c WHERE c.SUCURSAL=s.SUCURSAL AND c.PRODUCTO=s.PRODUCTO AND c.CUENTA=s.CUENTA AND c.MONEDA=s.MONEDA AND c.OPERACION=s.OPERACION AND c.ORDINAL=s.ORDINAL ),0) AS NU_PLAZ_RENO,
  SYSDATE AS FE_ACTU_DIA
--@001 Ini: INICIO DEL CAMBIO  
--FROM STG.T_SALDOS_02 s
--   JOIN STG.T_CO_MONEDAS_01 m  ON s.MONEDA=m.C6399
FROM STG.T_TMP_SALDOS_03 s
   JOIN STG.T_CO_MONEDAS_01 m    ON s.MONEDA=m.C6399
INNER JOIN STG.T_tmp_saldos_diarios_01 SD  ON S.jts_oid = SD.Saldo_Jts_Oid     
WHERE
  s.C9314 = 4 
--AND  s.C1604&lt;&gt;0
  AND S.sald_cta &lt;&gt; 0 
--@001 Fin: FIN DEL CAMBIO</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>Y</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>231</xloc>
      <yloc>43</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Leo T_TMP_INT_TLIVCART</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>OdsStgDS</connection>
    <sql>--Caso operaciones de TRADERLIVE
--@001 JZQ CASO-6428 Homologar EGD_AHORRO_PRO con EGD (ODS)
SELECT 
	EXTRACT(YEAR FROM TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;))*100+EXTRACT(MONTH FROM TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;)) AS NU_PERI_MES,
	TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) AS FE_SALDO,
	TO_DATE(&apos;${FECHAPROCESOEDY_S}&apos;,&apos;DD&#47;MM&#47;YYYY&apos;) AS FE_PROCESO,
	0 AS NU_OPERACION,
	1 AS NU_ORDINAL,
	12 AS CO_SUCURSAL,
	to_number(t.COD_CLIENTE_TOPAZ) AS CO_CLIENTE,
	DECODE(t.IDE_MON, &apos;999&apos;, 1, &apos;13&apos;, 2, 0) AS CO_MONEDA,
	t.IDE_FAMILIA AS CO_PRODUCTO,
	CASE WHEN NVL(t.NUM_DOCUM_TOPAZ, 0) = 0 THEN
			t.NUM_DOCUM
         ELSE
         	t.NUM_DOCUM_TOPAZ
    END AS NU_CUENTA,
    t.IMP_NOMINAL AS MO_APERTURA,
    NVL((t.FEC_VENCIM - t.FEC_EMIS),0) AS NU_PLAZO,
    t.FEC_VENCIM AS FE_VENCIMIENTO,
    t.TIR_COMPRA AS VL_TASA_INTE,
    &apos; &apos; AS CO_TIPO_RENO,
    0 AS CO_ANALISTA,
	0 AS CO_CARG_ANAL,
	&apos; &apos; AS CO_PUES_ANAL,
	0 AS CO_SUCU_ANAL,
    &apos;TRADERLIVE&apos; AS NO_MEDI_ORIG,
    &apos;0&apos; AS TI_PAGO_APER,
    0 AS MO_ITF_APER,
    t.DESC_FAMILIA AS NO_ORIG_LLEG,
    t.FEC_EMIS AS FE_APERTURA,
    NVL((t.FEC_CARTERA - t.FEC_EMIS),0) AS NU_DIAS_TRAN,
    NVL((t.FEC_VENCIM - t.FEC_CARTERA),0) AS NU_DIAS_REST_DPF,
    NVL(t.INTERES_CUPON,0) AS MO_INTE_DEVE,
    NVL(t.INTERES_CUPON,0) + NVL(t.IMP_NOMINAL,0) AS MO_SALD_ACTU,
	round(((NVL(t.INTERES_CUPON,0) + NVL(t.IMP_NOMINAL,0))*MON.C6440),2) as MO_SALD_ACTU_MN,
    &apos;N&apos; AS CO_ESTA_OPER,
    CASE WHEN ((t.FEC_VENCIM - t.FEC_EMIS) &gt; 360) THEN &apos;L&apos;
    	 ELSE &apos;C&apos;
    END AS CO_TIPO_PLAZ,
    NVL(a.ORDINAL_TIPO_ACREEDOR, 0) AS CO_TIPO_ACRE,
    to_number(t.CUENTA) AS CO_CUEN_CONT,
    0 AS CO_PIZARRA,
    t.ENCAJE AS IN_ENCAJE,
    t.IMP_NOMINAL AS MO_CAPITAL,
    0 AS CO_MOTI_CANC,
    0 AS NU_TOTA_CTAS,
    MON.C6440 AS VL_TIPO_CAMB_OFIC,
    t.NUM_DOCUM AS NU_DOCU_TLV,
    0 AS IN_SALD_JTS_OID,
	cli.C1058 AS CO_ACTI_ECON_INTE,
  	cli.C1840 AS CO_SECT_ECON_ALTE,
  	cli.C3205 AS CO_ACTIVIDAD,
  	cli.C1034 AS CO_ACTI_CIIU, 
	cli.C1584 AS CO_SECT_ECON_INTE,
  	CASE cli.EMPLEADO WHEN &apos;E&apos; THEN 1
				             ELSE 0
  	END AS IN_EMPLEADO,
	0 AS IN_ESTA_PASI,
	0 AS CO_TIPO_PASI,
	0 AS CO_TIPO_AHOR,
	0 AS NU_PLAZ_RENO,
    SYSDATE AS FE_ACTU_DIA   
FROM STG.T_TMP_INT_TLIVCART t
	 LEFT JOIN STG.T_VW_ANX15_EMP_TIPO_ACRE a
	 	ON a.COD_CLIENTE=t.COD_CLIENTE_TOPAZ
	 LEFT JOIN STG.T_CO_MONEDAS_01 MON
		ON MON.C6399=DECODE(t.IDE_MON, &apos;999&apos;, 1, &apos;13&apos;, 2, 0)
	 LEFT JOIN STG.T_CL_CLIENTES_01 cli
       	ON cli.C0902=t.COD_CLIENTE_TOPAZ
--@001 Ini: INICIO DEL CAMBIO 
WHERE t.Ide_Familia IN (SELECT ordinal
                                FROM stg.t_tc_tabladetablas
                               WHERE IdTabla = 428
                                 AND Ordinal &lt;&gt; 0
                                  AND Abreviatura IN (&apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;, &apos;10&apos;,&apos;6&apos;))  

--@001 FIN DEL CAMBIO</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>Y</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>231</xloc>
      <yloc>254</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Leo T_VW_ANX15_EMP_TIPO_ACRE</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>OdsStgDS</connection>
    <sql>SELECT 	DISTINCT a.ORDINAL_TIPO_ACREEDOR AS CO_TIPO_ACRE,
        a.COD_TIPO_ACREEDOR AS ID_TIPO_ACRE,
        a.DESC_TIPO_ACREEDOR AS DE_TIPO_ACRE,
		SYSDATE AS FE_ACTU_DIA
FROM 
	STG.T_VW_ANX15_EMP_TIPO_ACRE a</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>231</xloc>
      <yloc>375</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step_error_handling>
  </step_error_handling>
   <slave-step-copy-partition-distribution>
</slave-step-copy-partition-distribution>
   <slave_transformation>N</slave_transformation>
</transformation>
